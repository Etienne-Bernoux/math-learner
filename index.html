<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ã— Tables - Quiz Multiplication</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const QUESTIONS_COUNT = 10;

    const DIFFICULTY = {
      easy:   { label: "Facile",  timer: 12, multiplier: 1,   color: "from-green-500 to-emerald-500" },
      normal: { label: "Normal",  timer: 8,  multiplier: 1.5, color: "from-yellow-500 to-orange-500" },
      expert: { label: "Expert",  timer: 4,  multiplier: 2,   color: "from-red-500 to-pink-500" },
    };

    function generateQuestions(selectedTables) {
      const pool = [];
      selectedTables.forEach(table => {
        for (let i = 2; i <= 12; i++) {
          pool.push({ a: table, b: i });
        }
      });
      const shuffled = [...pool].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, Math.min(QUESTIONS_COUNT, shuffled.length));
    }

    function ConfigScreen({ onStart }) {
      const [selected, setSelected] = useState(new Set([2, 3, 4, 5]));
      const [difficulty, setDifficulty] = useState('normal');

      const toggle = (n) => {
        const next = new Set(selected);
        if (next.has(n)) next.delete(n);
        else next.add(n);
        setSelected(next);
      };

      const selectAll = () => setSelected(new Set([2,3,4,5,6,7,8,9,10,11,12]));
      const selectNone = () => setSelected(new Set());

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">
          <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 w-full max-w-md shadow-2xl border border-white/20">
            <h1 className="text-3xl font-bold text-white text-center mb-2">Ã— Tables</h1>
            <p className="text-purple-200 text-center mb-6">SÃ©lectionne les tables Ã  rÃ©viser</p>

            <div className="flex justify-center gap-2 mb-4">
              <button onClick={selectAll} className="text-sm text-purple-300 hover:text-white transition">Tout</button>
              <span className="text-purple-500">|</span>
              <button onClick={selectNone} className="text-sm text-purple-300 hover:text-white transition">Aucun</button>
            </div>

            <div className="grid grid-cols-4 gap-3 mb-6">
              {[2,3,4,5,6,7,8,9,10,11,12].map(n => (
                <button
                  key={n}
                  onClick={() => toggle(n)}
                  className={`aspect-square rounded-xl font-bold text-lg transition-all duration-200 ${
                    selected.has(n)
                      ? "bg-purple-500 text-white shadow-lg shadow-purple-500/50 scale-105"
                      : "bg-white/10 text-purple-200 hover:bg-white/20"
                  }`}
                >
                  {n}
                </button>
              ))}
            </div>

            <div className="mb-8">
              <p className="text-purple-200 text-center text-sm mb-3">DifficultÃ©</p>
              <div className="flex gap-2">
                {Object.entries(DIFFICULTY).map(([key, val]) => (
                  <button
                    key={key}
                    onClick={() => setDifficulty(key)}
                    className={`flex-1 py-3 rounded-xl font-medium text-sm transition-all duration-200 ${
                      difficulty === key
                        ? `bg-gradient-to-r ${val.color} text-white shadow-lg scale-105`
                        : "bg-white/10 text-purple-200 hover:bg-white/20"
                    }`}
                  >
                    <div>{val.label}</div>
                    <div className="text-xs opacity-75">{val.timer}s Â· x{val.multiplier}</div>
                  </button>
                ))}
              </div>
            </div>

            <button
              onClick={() => selected.size > 0 && onStart(Array.from(selected), difficulty)}
              disabled={selected.size === 0}
              className={`w-full py-4 rounded-2xl font-bold text-lg transition-all duration-300 ${
                selected.size > 0
                  ? "bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg hover:shadow-purple-500/50 hover:scale-[1.02]"
                  : "bg-white/10 text-white/30 cursor-not-allowed"
              }`}
            >
              C'est parti ! â†’
            </button>
          </div>
        </div>
      );
    }

    function QuizScreen({ questions, difficulty, onFinish }) {
      const config = DIFFICULTY[difficulty];
      const [index, setIndex] = useState(0);
      const [answer, setAnswer] = useState("");
      const [timer, setTimer] = useState(config.timer);
      const [results, setResults] = useState([]);
      const [feedback, setFeedback] = useState(null);
      const inputRef = useRef(null);
      const feedbackRef = useRef(false);

      const current = questions[index];
      const correctAnswer = current.a * current.b;

      const nextQuestion = () => {
        if (index + 1 >= questions.length) {
          const finalResult = { ...current, userAnswer: parseInt(answer) || null, correct: parseInt(answer) === correctAnswer };
          onFinish([...results, finalResult]);
        } else {
          setIndex(i => i + 1);
          setAnswer("");
          setTimer(config.timer);
          setFeedback(null);
          feedbackRef.current = false;
        }
      };

      const handleTimeout = () => {
        if (feedbackRef.current) return;
        feedbackRef.current = true;
        setFeedback('wrong');
        setResults(r => [...r, { ...current, userAnswer: null, correct: false }]);
        setTimeout(nextQuestion, 1200);
      };

      const handleSubmit = () => {
        if (feedbackRef.current || !answer) return;
        feedbackRef.current = true;
        const isCorrect = parseInt(answer) === correctAnswer;
        setFeedback(isCorrect ? 'correct' : 'wrong');
        setResults(r => [...r, { ...current, userAnswer: parseInt(answer), correct: isCorrect }]);
        setTimeout(nextQuestion, 1200);
      };

      useEffect(() => {
        if (feedbackRef.current) return;
        const interval = setInterval(() => {
          setTimer(t => {
            if (t <= 1) {
              handleTimeout();
              return config.timer;
            }
            return t - 1;
          });
        }, 1000);
        return () => clearInterval(interval);
      }, [index]);

      useEffect(() => {
        if (!feedbackRef.current) inputRef.current?.focus();
      }, [index, feedback]);

      const timerPercent = (timer / config.timer) * 100;
      const timerColor = timer <= 3 ? "bg-red-500" : timer <= 5 ? "bg-yellow-500" : "bg-green-500";

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">
          <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 w-full max-w-md shadow-2xl border border-white/20">
            <div className="flex justify-between items-center mb-6">
              <span className="text-purple-300 font-medium">{index + 1} / {questions.length}</span>
              <div className="flex gap-1">
                {results.map((r, i) => (
                  <div key={i} className={`w-2 h-2 rounded-full ${r.correct ? 'bg-green-400' : 'bg-red-400'}`} />
                ))}
                {Array(questions.length - results.length).fill(0).map((_, i) => (
                  <div key={`empty-${i}`} className="w-2 h-2 rounded-full bg-white/20" />
                ))}
              </div>
            </div>

            <div className="h-2 bg-white/10 rounded-full mb-8 overflow-hidden">
              <div className={`h-full ${timerColor} transition-all duration-1000 ease-linear`} style={{ width: `${timerPercent}%` }} />
            </div>

            <div className={`text-center mb-8 transition-all duration-300 ${feedback ? 'scale-95 opacity-80' : ''}`}>
              <div className="text-6xl font-bold text-white mb-2">{current.a} Ã— {current.b}</div>
              <div className="text-2xl text-purple-300">= ?</div>
            </div>

            <div>
              <input
                ref={inputRef}
                type="text"
                inputMode="numeric"
                pattern="[0-9]*"
                value={answer}
                onChange={e => setAnswer(e.target.value.replace(/[^0-9]/g, ''))}
                onKeyDown={e => { if (e.key === 'Enter' && answer && !feedback) handleSubmit(); }}
                disabled={!!feedback}
                className={`w-full text-center text-4xl font-bold py-4 rounded-2xl outline-none transition-all duration-300 ${
                  feedback === 'correct'
                    ? 'bg-green-500/30 text-green-300 border-2 border-green-500'
                    : feedback === 'wrong'
                    ? 'bg-red-500/30 text-red-300 border-2 border-red-500'
                    : 'bg-white/10 text-white border-2 border-transparent focus:border-purple-500'
                }`}
                placeholder="?"
                autoComplete="off"
              />

              {feedback && (
                <div className={`text-center mt-4 text-xl font-bold ${feedback === 'correct' ? 'text-green-400' : 'text-red-400'}`}>
                  {feedback === 'correct' ? 'âœ“ Correct !' : `âœ— C'Ã©tait ${correctAnswer}`}
                </div>
              )}

              {!feedback && (
                <button
                  onClick={handleSubmit}
                  disabled={!answer}
                  className={`w-full mt-6 py-4 rounded-2xl font-bold text-lg transition-all ${
                    answer
                      ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg'
                      : 'bg-white/10 text-white/30 cursor-not-allowed'
                  }`}
                >
                  Valider
                </button>
              )}
            </div>
          </div>
        </div>
      );
    }

    function ResultScreen({ results, difficulty, onRestart, onConfig }) {
      const config = DIFFICULTY[difficulty];
      const correctCount = results.filter(r => r.correct).length;
      const score = Math.round(correctCount * config.multiplier * 10);
      const percent = Math.round((correctCount / results.length) * 100);

      const getMessage = () => {
        if (percent === 100) return { emoji: "ðŸ†", text: "Parfait !" };
        if (percent >= 80) return { emoji: "ðŸ”¥", text: "Excellent !" };
        if (percent >= 60) return { emoji: "ðŸ’ª", text: "Pas mal !" };
        if (percent >= 40) return { emoji: "ðŸ“š", text: "Continue !" };
        return { emoji: "ðŸŽ¯", text: "Ã€ retravailler" };
      };

      const msg = getMessage();

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">
          <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 w-full max-w-md shadow-2xl border border-white/20">
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">{msg.emoji}</div>
              <div className="text-5xl font-bold text-white mb-1">{score} pts</div>
              <div className="text-lg text-purple-300 mb-1">{correctCount}/{results.length} Â· {config.label} (x{config.multiplier})</div>
              <div className="text-xl text-purple-200">{msg.text}</div>
            </div>

            <div className="bg-white/5 rounded-2xl p-4 mb-8 max-h-48 overflow-y-auto">
              {results.map((r, i) => (
                <div key={i} className={`flex justify-between items-center py-2 ${i > 0 ? 'border-t border-white/10' : ''}`}>
                  <span className="text-purple-200">{r.a} Ã— {r.b} = {r.a * r.b}</span>
                  <span className={r.correct ? 'text-green-400' : 'text-red-400'}>
                    {r.correct ? 'âœ“' : `âœ— ${r.userAnswer ?? 'â€”'}`}
                  </span>
                </div>
              ))}
            </div>

            <div className="space-y-3">
              <button
                onClick={onRestart}
                className="w-full py-4 rounded-2xl font-bold text-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg hover:shadow-purple-500/50 transition-all"
              >
                Rejouer â†»
              </button>
              <button
                onClick={onConfig}
                className="w-full py-3 rounded-2xl font-medium text-purple-300 bg-white/10 hover:bg-white/20 transition-all"
              >
                Changer les tables
              </button>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [screen, setScreen] = useState('config');
      const [tables, setTables] = useState([]);
      const [difficulty, setDifficulty] = useState('normal');
      const [questions, setQuestions] = useState([]);
      const [results, setResults] = useState([]);

      const startQuiz = (selectedTables, selectedDifficulty) => {
        setTables(selectedTables);
        setDifficulty(selectedDifficulty);
        setQuestions(generateQuestions(selectedTables));
        setResults([]);
        setScreen('quiz');
      };

      const finishQuiz = (quizResults) => {
        setResults(quizResults);
        setScreen('result');
      };

      const restart = () => {
        setQuestions(generateQuestions(tables));
        setResults([]);
        setScreen('quiz');
      };

      const goConfig = () => setScreen('config');

      if (screen === 'config') return <ConfigScreen onStart={startQuiz} />;
      if (screen === 'quiz') return <QuizScreen questions={questions} difficulty={difficulty} onFinish={finishQuiz} />;
      return <ResultScreen results={results} difficulty={difficulty} onRestart={restart} onConfig={goConfig} />;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
